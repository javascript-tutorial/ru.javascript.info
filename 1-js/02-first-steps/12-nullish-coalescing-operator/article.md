# Оператор объединения с null '??'

[recent browser="new"]

Оператор объединения с null `??` обеспечивает краткий синтаксис для выбора первой определённой переменной из списка.

Результатом выражения `a ?? b` является:
- `a`, если её значение не `null` или `undefined`,
- `b` в ином случае.

То есть `x = a ?? b` служит сокращением для:

```js
x = (a !== null && a !== undefined) ? a : b;
```

Рассмотрим пример подлиннее.

Допустим, переменные `firstName`, `lastName` и `nickName` соответствуют имени, фамилии и нику пользователя. Все три переменные могут быть неопределёнными, если пользователь решит не вводить никаких данных.

Но мы бы хотели отобразить имя пользователя в любом случае -- употребив одну из переменных или строку "Аноним", если все переменные "пусты".

Оператор `??` поможет нам выбрать первое определённое значение:

```js run
let firstName = null;
let lastName = null;
let nickName = "Суперкодер";

// покажем первое значение, отличное от null или undefined
*!*
alert(firstName ?? lastName ?? nickName ?? "Аноним"); // Суперкодер
*/!*
```

## Отличия от оператора ||

Оператор ИЛИ `||` можно использовать таким же образом, как и оператор `??`. В последнем примере мы можем заменить `??` на `||`, и результат останется прежним. Такой вариант мы уже видели в [предыдущей главе](info:logical-operators#or-finds-the-first-truthy-value).

Но есть существенные отличия:
- `||` возвращает первое *истинное* значение.
- `??` возвращает первое *определённое* значение.

Это очень важно, если мы хотим отличить `null/undefined` от числа `0` или пустой строки `''`.

Представьте такой пример:

```js
height = height ?? 100;
```

Тут мы присваиваем переменной `height` число `100`, если она не определена.

Сравним с оператором `||`:

```js run
let height = 0;

alert(height || 100); // 100
alert(height ?? 100); // 0
```

Тут выражение `height || 100` не отличает нулевую высоту от неопределённой, то есть от значений `null`, `undefined` или любго другого ложного. Поэтому в результате вычисления ми получаем `100`.

Выражение `height ?? 100` возвратит `100`, только если `height` в точности равно `null` или `undefined`. Поэтому во втором случае `alert` покажет значение нулевой высоты как `0`, без ошибочного изменения.

Какое поведение предпочесть — зависит от ситуации. Если нулевая высота допустима, следует выбрать оператор `??`.

## Приоритет

Приоритет оператора `??` сравнительно низкий: `5` в [таблице MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Operator_Precedence#Table).

Поэтому `??` вычисляется после большинства других операций, но перед операторами `=` и `?`.

Если необходимо выбрать значение в сложном выражении, оператору `??` можно "помочь" скобками:

```js run
let height = null;
let width = null;

// важно: используйте скобки
let area = (height ?? 100) * (width ?? 50);

alert(area); // 5000
```

Если мы опустим скобки, оператор `*` будет вычислен раньше `??`, потому что его приоритет выше.

То есть выражение будет работать идентично такому:

```js
// скорее всего, это ошибка
let area = height ?? (100 * width) ?? 50;
```

Следует ещё упомянуть об одном ограничении на уровне языка.

**По соображениям безопасности, запрещено использовать `??` вместе с операторами `&&` и `||`.**

Следующий код вызовет ошибку:

```js run
let x = 1 && 2 ?? 3; // Синтаксическая ошибка
```

Ограничение, конечно, спорное, но его внесли в спецификацию языка с целью предотвратить ошибки программистов, так как разработчики начали заменять `??` на `||`.

Чтобы обойти это ограничение, используйте явные скобки:

```js run
*!*
let x = (1 && 2) ?? 3; // Работает
*/!*

alert(x); // 2
```

## Итого

- Оператор объединения с null `??` обеспечивает краткий способ выбрать значение, отличное от `null` и `undefined`.

    С сего помощью присваивают значения по умолчанию:

    ```js
    // установить height=100, если height равно null или undefined
    height = height ?? 100;
    ```

- Оператор `??` имеет очень низкий приоритет, чуть выше операторов `?` и `=`.
- Использование данного оператора вместе с `||` или `&&` без явных скобок запрещено.
